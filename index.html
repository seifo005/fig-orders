<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ุญุฌูุฒุงุช ุฃุตูุงู ุงูุชูู โ ุทุจุงุนุฉ + ุฅุญุตุงุฆูุงุช ูุงููุฉ + ุดุชูุงุช/ุนููู</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root { --b:#e5e7eb; --bg:#f3f4f6; --fg:#111; --muted:#6b7280; }
    html, body { height:100%; background:var(--bg); color:var(--fg); font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 12px 16px; }
    .row { display: grid; gap: 12px; }
    @media (min-width:768px){ .cols-2{grid-template-columns:1fr 1fr} .cols-3{grid-template-columns:repeat(3,1fr)} .cols-4{grid-template-columns:repeat(4,1fr)} }
    .card { background:#fff; border:1px solid var(--b); border-radius:16px; padding:16px; }
    .pill { border:1px solid var(--b); background:#fff; border-radius:999px; padding:6px 12px; cursor:pointer; }
    .btn { border:1px solid var(--b); border-radius:12px; padding:8px 12px; background:#fff; cursor:pointer; }
    .btn.primary { background:#111; color:#fff; }
    input,select,textarea { width:100%; box-sizing:border-box; border:1px solid var(--b); border-radius:10px; padding:8px 10px; }
    table { width:100%; border-collapse:collapse; }
    th,td { padding:10px; border-top:1px solid #f0f0f0; text-align:right; vertical-align:top; }
    thead th { background:#fafafa; position:sticky; top:0; z-index:1; }
    .muted { color:var(--muted); font-size:12px; }
    .badge { font-size:12px; border:1px solid var(--b); border-radius:999px; padding:2px 8px; display:inline-block; }
    .hidden { display:none; }
    .print-logo { font-weight:800; font-size:18px; }
    .print-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; }
    .print-box { border:1px solid #ccc; border-radius:12px; padding:12px; margin-bottom:8px; }
    @media print {
      .no-print { display:none !important; }
      body { background:#fff; }
      .print-page { page-break-after: always; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <header style="display:flex;align-items:center;justify-content:space-between;gap:12px;padding-bottom:12px">
    <h1 style="font-size:22px;font-weight:900">๐ฆ ุญุฌูุฒุงุช ุฃุตูุงู ุงูุชูู โ ูุณุฎุฉ v3</h1>
    <nav style="display:flex;flex-wrap:wrap;gap:8px">
      <button class="pill" data-tab="dashboard">ููุญุฉ ุงูุจูุงูุงุช</button>
      <button class="pill" data-tab="new">ุฅุถุงูุฉ ุญุฌุฒ</button>
      <button class="pill" data-tab="list">ุงูุญุฌูุฒุงุช</button>
      <button class="pill" data-tab="settings">ุงูุฅุนุฏุงุฏุงุช</button>
    </nav>
  </header>

  <section id="tab-dashboard" class="row hidden">
    <div id="chartsWarning" class="card no-print hidden">โ๏ธ ูู ุชูุญูููู ููุชุจุฉ Chart.jsุ ุณูุนูู ุงูุชุทุจูู ุจุฏูู ุงูุฑุณูู.</div>
    <div id="storageWarning" class="card no-print hidden">โ๏ธ ุชุนุฐูุฑ ุงูุญูุธ ุงููุญูู. ุงุฑุจุท ูููุงุช JSON ููุญูุธ ุงููุจุงุดุฑ.</div>
    <div class="row cols-4">
      <div class="card"><div class="muted">ุนุฏุฏ ุงูุทูุจุงุช</div><div id="kpi-orders" style="font-size:26px;font-weight:800">0</div></div>
      <div class="card"><div class="muted">ุฅุฌูุงูู ุงูุนูุงุตุฑ</div><div id="kpi-items" style="font-size:26px;font-weight:800">0</div></div>
      <div class="card"><div class="muted">ุฅุฌูุงูู ุงููููุงุช</div><div id="kpi-qty" style="font-size:26px;font-weight:800">0</div></div>
      <div class="card"><div class="muted">ุงููููุฉ ุงูุฅุฌูุงููุฉ (ูุชููุนุฉ)</div><div id="kpi-amount" style="font-size:26px;font-weight:800">0 ุฏุฌ</div></div>
    </div>
    <div class="row cols-3">
      <div class="card"><div class="muted">ูุณุชูู (ุชู ุงูุชุณููู)</div><div id="kpi-delivered-amount" style="font-size:24px;font-weight:800">0 ุฏุฌ</div></div>
      <div class="card"><div class="muted">ุงูุนุฑุจูู ุงูููุณุชูู</div><div id="kpi-deposits" style="font-size:24px;font-weight:800">0 ุฏุฌ</div></div>
      <div class="card"><div class="muted">ุงููุชุจูู ุนูู ุงูุฒุจุงุฆู</div><div id="kpi-outstanding" style="font-size:24px;font-weight:800">0 ุฏุฌ</div></div>
    </div>
    <div class="row cols-2">
      <div class="card">
        <h3 style="margin:0 0 10px 0">๐ ุงููููุงุช ุญุณุจ ุงูุตูู</h3>
        <canvas id="chartByVariety" height="280"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 10px 0">๐ ุนุฏุฏ ุงูุทูุจุงุช ูููููุง</h3>
        <canvas id="chartByDay" height="280"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 10px 0">๐ฐ ุงููุฏุงุฎูู ุดูุฑููุง (ุงูููุณููููุฉ)</h3>
        <canvas id="chartRevenueMonthly" height="280"></canvas>
      </div>
      <div class="card">
        <h3 style="margin:0 0 10px 0">๐ง ุชูุฒูุน ุงูุญุงูุงุช</h3>
        <div style="display:flex;justify-content:center"><canvas id="chartStatuses" height="280"></canvas></div>
      </div>
    </div>
  </section>

  <section id="tab-new" class="row">
    <div class="card">
      <h3 style="margin:0 0 10px 0">โ ุฅุถุงูุฉ ุญุฌุฒ ุฌุฏูุฏ (ูุฏุนู ุนุฏุฉ ุฃุตูุงู ูุฃููุงุน: ุดุชูุฉ/ุนููุฉ) <span id="editBadge" class="badge" style="display:none;margin-right:6px">ูุถุน ุชุนุฏูู</span></h3>
      <form id="orderForm" class="row cols-2">
        <div class="card">
          <h4 style="margin:0 0 10px 0">๐ค ูุนูููุงุช ุงูุฒุจูู</h4>
          <div class="row cols-2">
            <label class="muted">ุงูุงุณู ุงููุงูู *<input id="customerName" required></label>
            <label class="muted">ุงููุงุชู *<input id="phone" inputmode="numeric" pattern="\d+" required></label>
            <label class="muted">ุงููุฏููุฉ<input id="city"></label>
            <label class="muted">ุงูุนููุงู<input id="address"></label>
          </div>
          <div class="muted">ุงูุฃุฑูุงู ููุท ูุณููุญ ุจูุง ูููุงุชูุ ูุชู ุฅุฒุงูุฉ ุงูุฃุญุฑู ุชููุงุฆููุง.</div>
          <div style="margin-top:8px; display:flex; gap:8px; flex-wrap:wrap">
            <button id="btn-link-orders-json" type="button" class="btn no-print">๐ ุฑุจุท ููู orders.json</button>
          </div>
        </div>
        <div class="card">
          <h4 style="margin:0 0 10px 0">๐ฑ ุนูุงุตุฑ ุงูุทูุจ</h4>
          <div class="row cols-2">
            <label class="muted">ููุน ุงูุนูุตุฑ
              <select id="itemKind">
                <option value="seedling">ุดุชูุฉ</option>
                <option value="cutting">ุนููุฉ</option>
              </select>
            </label>
            <label class="muted">ุงูุตูู *<select id="varietySelect"></select></label>
            <label class="muted">ุงููููุฉ *<input id="itemQty" type="number" value="1" min="1"></label>
            <label class="muted">ุงูุณุนุฑ ูููุญุฏุฉ (ุฏุฌ)<input id="itemPrice" type="number" min="0" step="1" placeholder="ููุชูุฆ ุชููุงุฆููุง"></label>
            <div style="align-self:end"><button id="addItem" type="button" class="btn">ุฅุถุงูุฉ ุนูุตุฑ</button></div>
          </div>
          <div style="margin-top:8px; overflow:auto">
            <table id="itemsTable">
              <thead><tr><th>#</th><th>ุงูููุน</th><th>ุงูุตูู</th><th>ุงููููุฉ</th><th>ุงูุณุนุฑ</th><th>ุงูุฅุฌูุงูู</th><th>โ</th></tr></thead>
              <tbody id="itemsBody"></tbody>
              <tfoot><tr style="background:#fafafa;font-weight:600"><td colspan="5">ุงูุฅุฌูุงูู</td><td id="itemsTotal">0 ุฏุฌ</td><td></td></tr></tfoot>
            </table>
          </div>
          <div class="row cols-2" style="margin-top:8px">
            <label class="muted">ุงูุญุงูุฉ
              <select id="status">
                <option value="pending">ููุฏ ุงูุงูุชุธุงุฑ</option>
                <option value="confirmed">ูุคูุฏ</option>
                <option value="shipped">ููุฑุณูู</option>
                <option value="delivered">ุชูู ุงูุชุณููู</option>
                <option value="cancelled">ููุบู</option>
              </select>
            </label>
            <label class="muted">ุทุฑููุฉ ุงูุชูุตูู
              <select id="deliveryMethod">
                <option value="yalidine_office">ููุชุจ Yalidine</option>
                <option value="home">ุชูุตูู ููููุฒู</option>
                <option value="pickup">ุงุณุชูุงู ูู ุงููุดุชู</option>
              </select>
            </label>
            <label class="muted">ุนุฑุจูู (ุฏุฌ)<input id="depositDZD" type="number" min="0" step="1"></label>
            <label class="muted">ููุงุญุธุงุช<input id="notes"></label>
          </div>
        </div>
        <div style="grid-column:1/-1;display:flex;gap:8px;align-items:center">
          <button class="btn primary" type="submit">ุญูุธ ุงูุญุฌุฒ</button>
          <button class="btn" type="reset" id="resetForm">ูุณุญ</button>
          <button class="btn no-print" id="btn-print-order" type="button">๐จ๏ธ ุทุจุงุนุฉ ูุฐุง ุงูุญุฌุฒ</button>
        </div>
      </form>
    </div>
  </section>

  <section id="tab-list" class="row hidden">
    <div class="card" style="display:flex;flex-wrap:wrap;gap:8px;align-items:end">
      <label class="muted">ุจุญุซ<input id="filter-q" placeholder="ุงุณู/ูุงุชู/ูุฏููุฉ/ุตูู"></label>
      <label class="muted">ุงูุญุงูุฉ
        <select id="filter-status">
          <option value="all">ุงููู</option>
          <option value="pending">ููุฏ ุงูุงูุชุธุงุฑ</option>
          <option value="confirmed">ูุคูุฏ</option>
          <option value="shipped">ููุฑุณูู</option>
          <option value="delivered">ุชูู ุงูุชุณููู</option>
          <option value="cancelled">ููุบู</option>
        </select>
      </label>
      <button id="btn-export-selected" class="btn no-print">ุชุตุฏูุฑ ุงููุญุฏุฏ</button>
      <button id="btn-print-selected" class="btn no-print">๐จ๏ธ ุทุจุงุนุฉ ุงููุญุฏุฏ</button>
    </div>
    <div class="card" style="overflow:auto;max-height:60vh">
      <table id="ordersTable">
        <thead>
          <tr>
            <th><input id="checkAll" type="checkbox"></th>
            <th>ุงูุชุงุฑูุฎ</th>
            <th>ุงูุงุณู</th>
            <th>ุงููุงุชู</th>
            <th>ุงูุนูุงุตุฑ</th>
            <th>ุงูุฅุฌูุงูู (ุฏุฌ)</th>
            <th>ุงูุญุงูุฉ</th>
            <th>ุงููุฏููุฉ</th>
            <th>ููุงุญุธุงุช</th>
            <th>ุฅุฌุฑุงุกุงุช</th>
          </tr>
        </thead>
        <tbody id="ordersBody"></tbody>
      </table>
    </div>
  </section>

  <section id="tab-settings" class="row hidden">
    <div class="card row">
      <h3 style="margin:0">๐พ ุงููุณุฎ ุงูุงุญุชูุงุทู ููุทูุจุงุช</h3>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="btn-export-all" class="btn no-print">ุชุตุฏูุฑ ูู ุงูุทูุจุงุช JSON</button>
        <button id="btn-import" class="btn no-print">ุงุณุชูุฑุงุฏ JSON</button>
        <input id="fileImport" type="file" accept="application/json" hidden>
        <button id="btn-link-orders-json" class="btn no-print">๐ ุฑุจุท orders.json</button>
      </div>
    </div>

    <div class="card row">
      <div style="display:flex;align-items:center;gap:8px;justify-content:space-between;flex-wrap:wrap">
        <h3 style="margin:0">๐ฑ ุฅุฏุงุฑุฉ ุงูุฃุตูุงู ูุงูุฃุณุนุงุฑ (ุชุญุฑูุฑ ุฏุงุฎู ุงูุชุทุจูู)</h3>
        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button id="btn-link-varieties-json" class="btn no-print">๐ ุฑุจุท varieties.json</button>
          <button id="saveVarieties" class="btn primary">ุญูุธ ุงูุฃุตูุงู</button>
          <button id="addVariety" class="btn">ุฅุถุงูุฉ ุตูู</button>
        </div>
      </div>
      <p class="muted">ููููู ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู ููุง. ุฅุฐุง ุฑุจุทุช <code>varieties.json</code> (Chrome/Edge) ุณูุชู ุงูุญูุธ ูุจุงุดุฑุฉ ูู ุงููููุ ูุฅูุง ูุณููุญูุธ ูุญูููุง.</p>
      <div style="overflow:auto">
        <table id="varietiesTable">
          <thead><tr><th>ุงูุตูู</th><th>ุงูุณุนุฑ ุงูุงูุชุฑุงุถู (ุฏุฌ)</th><th>โ</th></tr></thead>
          <tbody id="varietiesBody"></tbody>
        </table>
      </div>
    </div>
  </section>
</div>
<script src="app.js"></script>
</body>
</html>