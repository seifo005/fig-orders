<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>FIG Orders â€” Fresh Start v1.0</title>
<style>
:root{
  --bg:#0f172a; --card:#111827; --text:#e5e7eb; --mut:#9ca3af;
  --border:#1f2937; --chip:#0b1220; --accent:#22c55e; --danger:#ef4444;
}
*{box-sizing:border-box}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text)}
header{position:fixed;top:0;left:0;right:0;z-index:1000;background:#111827;border-bottom:1px solid var(--border);padding:10px 12px}
h1{margin:0 0 6px 0;font-size:18px}
.sub{color:var(--mut);font-size:12px}
.nav{display:flex;gap:8px;flex-wrap:wrap}
.tab{border:1px solid var(--border);background:#0b1220;color:#cbd5e1;padding:8px 12px;border-radius:999px;cursor:pointer}
.tab.active{background:var(--accent);color:#052a13;border-color:transparent;font-weight:700}
.container{max-width:1100px;margin:0 auto;padding:100px 12px 80px}
.view{display:none}
.view.active{display:block}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:12px;margin:10px 0}
.row2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
input,select,textarea{width:100%;padding:10px;background:#0b1220;border:1px solid var(--border);border-radius:10px;color:var(--text);font-size:14px}
button{border:1px solid var(--border);background:#0b1220;color:#e5e7eb;border-radius:10px;padding:10px 12px;cursor:pointer}
button.primary{background:var(--accent);color:#06250f;border-color:transparent;font-weight:700}
button.danger{background:var(--danger);color:#2b0a0a;border-color:transparent;font-weight:700}
.table{width:100%;border-collapse:collapse}
th,td{border-bottom:1px solid var(--border);padding:8px;font-size:13px;text-align:right;vertical-align:top}
.badge{display:inline-block;background:var(--chip);border:1px solid var(--border);border-radius:999px;padding:2px 8px;color:#cbd5e1;font-size:11px}
.dock{position:fixed;right:12px;bottom:calc(12px + env(safe-area-inset-bottom));z-index:1001;display:flex;gap:8px;background:rgba(17,24,39,.95);border:1px solid var(--border);padding:6px;border-radius:999px}
.dock button{border-radius:999px;padding:10px 14px}
.dock button.active{background:var(--accent);color:#052a13;border-color:transparent;font-weight:700}
.small{font-size:12px;color:var(--mut)}
</style>
</head>
<body>
<header>
  <h1>ğŸ“‹ FIG Orders â€” Fresh Start v1.0</h1>
  <div class="sub">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª (Ø±Ø¦ÙŠØ³ÙŠØ©) â€¢ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª â€¢ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø£ØµÙ†Ø§Ù</div>
  <div class="nav">
    <button class="tab" data-view="stats" type="button">ğŸ“Š Ø§Ù„Ø¥Ø­ØµØ§Ø¡Ø§Øª</button>
    <button class="tab" data-view="orders" type="button">ğŸ§¾ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
    <button class="tab" data-view="catalog" type="button">ğŸ§º Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
  </div>
</header>

<div class="dock">
  <button data-view="stats" type="button">ğŸ“Š</button>
  <button data-view="orders" type="button">ğŸ§¾</button>
  <button data-view="catalog" type="button">ğŸ§º</button>
</div>

<!-- Stats -->
<section id="view-stats" class="container view active">
  <section class="card">
    <h2 style="margin:0 0 8px 0;">ğŸ“ˆ Ù…Ù„Ø®Øµ</h2>
    <div class="row3">
      <div class="card"><div class="small">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</div><div id="st_orders" style="font-weight:700;font-size:18px">0</div></div>
      <div class="card"><div class="small">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø´ØªÙ„Ø§Øª</div><div id="st_qty" style="font-weight:700;font-size:18px">0</div></div>
      <div class="card"><div class="small">Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</div><div id="st_sum" style="font-weight:700;font-size:18px">0</div></div>
    </div>
  </section>
</section>

<!-- Orders -->
<section id="view-orders" class="container view">
  <section class="card">
    <h2 style="margin:0 0 8px 0;">ğŸ§¾ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
    <div class="row2">
      <section class="card">
        <h3 style="margin:0 0 6px 0;">Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ / ØªØ¹Ø¯ÙŠÙ„</h3>
        <div class="row2">
          <div><label class="small">Ø§Ù„Ø§Ø³Ù…</label><input id="f_name" placeholder="Ø§Ø³Ù… Ø§Ù„Ø²Ø¨ÙˆÙ†"></div>
          <div><label class="small">Ø§Ù„Ù‡Ø§ØªÙ</label><input id="f_phone" placeholder="05.."></div>
        </div>
        <div class="row2">
          <div><label class="small">Ø§Ù„Ø­Ø§Ù„Ø©</label>
            <select id="f_status">
              <option value="New">Ø¬Ø¯ÙŠØ¯</option>
              <option value="Confirmed">Ù…Ø¤ÙƒØ¯</option>
              <option value="Ready">Ø¬Ø§Ù‡Ø²</option>
              <option value="Delivered">Ù…ÙØ³Ù„Ù‘Ù…</option>
              <option value="Canceled">Ù…Ù„ØºÙ‰</option>
            </select>
          </div>
          <div><label class="small">Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input id="f_date" type="date"></div>
        </div>
        <div class="row2">
          <div><label class="small">Ø§Ù„ØªÙˆØµÙŠÙ„</label>
            <select id="f_delivery">
              <option value="Office">Ù…ÙƒØªØ¨ ÙŠØ§Ù„ÙŠØ¯ÙŠÙ†</option>
              <option value="Home">Ù„Ù„Ø¹Ù†ÙˆØ§Ù†</option>
              <option value="Pickup">Ø§Ø³ØªÙ„Ø§Ù… ÙŠØ¯ÙˆÙŠ</option>
            </select>
          </div>
          <div><label class="small">Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©</label><input id="f_city" placeholder="Ø®Ù†Ø´Ù„Ø©.."></div>
        </div>
        <div><label class="small">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label><textarea id="f_notes" placeholder="..."></textarea></div>

        <div class="card" style="background:#0b1220">
          <h4 style="margin:0 0 6px 0;">Ø£ØµÙ†Ø§Ù Ø§Ù„Ø·Ù„Ø¨</h4>
          <div class="row3">
            <div>
              <label class="small">Ø§Ù„ØµÙ†Ù (Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©)</label>
              <select id="i_sel"></select>
              <div class="small">Ø­Ø±Ù‘Ø± Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ù…Ù† Ø¨ÙˆØ§Ø¨Ø© "Ø§Ù„Ø£ØµÙ†Ø§Ù"</div>
            </div>
            <div><label class="small">Ø§Ù„Ø¹Ø¯Ø¯</label><input id="i_qty" type="number" min="1" value="1"></div>
            <div><label class="small">Ø³Ø¹Ø±/ÙˆØ­Ø¯Ø©</label><input id="i_ppu" type="number" min="0" step="0.01" placeholder="Ø¯Ø¬"></div>
          </div>
          <div style="margin-top:8px"><button id="i_add" type="button">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ†Ù</button></div>
          <table class="table" id="it_tbl">
            <thead><tr><th>#</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø³Ø¹Ø±/ÙˆØ­Ø¯Ø©</th><th>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹</th><th>â€”</th></tr></thead>
            <tbody></tbody>
          </table>
          <div class="small" id="it_hint">Ø£Ø¶Ù ØµÙ†ÙÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø£Ùˆ Ø£ÙƒØ«Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.</div>
        </div>

        <div style="display:flex;gap:8px;flex-wrap:wrap">
          <button class="primary" id="save" type="button">Ø­ÙØ¸</button>
          <button id="new" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</button>
          <button class="danger" id="del" type="button" style="display:none">Ø­Ø°Ù</button>
        </div>
      </section>

      <section class="card">
        <h3 style="margin:0 0 6px 0;">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h3>
        <input id="q" placeholder="Ø¨Ø­Ø« Ø¨Ø§Ù„Ø§Ø³Ù… / Ø§Ù„Ù‡Ø§ØªÙ / Ø§Ù„ØµÙ†Ù...">
        <table class="table" id="tbl">
          <thead><tr><th>#</th><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø£ØµÙ†Ø§Ù</th><th>Ø§Ù„Ø¹Ø¯Ø¯</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>â€”</th></tr></thead>
          <tbody></tbody>
        </table>
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          <button id="print" type="button">Ø·Ø¨Ø§Ø¹Ø© Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±</button>
          <button class="danger" id="clear" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
        </div>
      </section>
    </div>
  </section>
</section>

<!-- Catalog -->
<section id="view-catalog" class="container view">
  <section class="card">
    <h2 style="margin:0 0 8px 0;">ğŸ§º Ø§Ù„Ø£ØµÙ†Ø§Ù</h2>
    <div class="row2">
      <div><label class="small">Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù</label><input id="c_name" placeholder="Black Madeira"></div>
      <div><label class="small">Ø³Ø¹Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ</label><input id="c_ppu" type="number" min="0" step="0.01" placeholder="Ø¯Ø¬"></div>
    </div>
    <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
      <button id="c_add" type="button">Ø¥Ø¶Ø§ÙØ©</button>
      <button class="danger" id="c_clear" type="button">ØªÙØ±ÙŠØº Ø§Ù„Ø£ØµÙ†Ø§Ù</button>
    </div>
    <table class="table" id="c_tbl">
      <thead><tr><th>#</th><th>Ø§Ù„ØµÙ†Ù</th><th>Ø³Ø¹Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ</th><th>â€”</th></tr></thead>
      <tbody></tbody>
    </table>
  </section>
</section>

<script>
(function(){
  // ===== Basic helpers =====
  function $(s){return document.querySelector(s)}
  function $$(s){return Array.prototype.slice.call(document.querySelectorAll(s))}
  function fmt(n){return (n||0).toLocaleString('ar-DZ')}
  function uid(){return 'o_'+Math.random().toString(36).slice(2,9)+Date.now().toString(36).slice(-4)}
  function idCat(){return 'cv_'+Math.random().toString(36).slice(2,8)}
  function idItem(){return 'it_'+Math.random().toString(36).slice(2,8)}

  // ===== Tabs routing (simple & robust)
  function switchView(v){
    var ids=['stats','orders','catalog']
    if(ids.indexOf(v)===-1) v='stats'
    $$('.tab').forEach(t=>t.classList.toggle('active', t.dataset.view===v))
    $$('.dock button').forEach(b=>b.classList.toggle('active', b.dataset.view===v))
    $('#view-stats').classList.toggle('active', v==='stats')
    $('#view-orders').classList.toggle('active', v==='orders')
    $('#view-catalog').classList.toggle('active', v==='catalog')
    if(location.hash!=='#'+v) location.hash='#'+v
    window.scrollTo(0,0)
  }
  $$('.tab').forEach(t=>t.addEventListener('click', ()=>switchView(t.dataset.view)))
  $$('.dock button').forEach(b=>b.addEventListener('click', ()=>switchView(b.dataset.view)))
  window.addEventListener('hashchange', ()=>switchView((location.hash||'').replace('#','')||'stats'))
  switchView((location.hash||'').replace('#','')||'stats')

  // ===== Storage keys =====
  const K_CAT='fig_catalog_v1', K_ORD='fig_orders_v1'

  function load(k){try{return JSON.parse(localStorage.getItem(k))||[]}catch(e){return[]}}
  function save(k,v){try{localStorage.setItem(k, JSON.stringify(v))}catch(e){alert('ØªØ¹Ø°Ø± Ø§Ù„Ø­ÙØ¸')}}

  // ===== Catalog =====
  let catalog = load(K_CAT)
  function renderCatalog(){
    const tb=$('#c_tbl tbody'); tb.innerHTML=''
    catalog.forEach((c,i)=>{
      const tr=document.createElement('tr')
      tr.innerHTML = `<td class="small">${i+1}</td><td>${c.name||''}</td><td>${fmt(c.ppu||0)}</td>
      <td><a href="#" data-act="e" data-id="${c.id}">ØªØ¹Ø¯ÙŠÙ„</a> â€¢ <a href="#" data-act="d" data-id="${c.id}">Ø­Ø°Ù</a></td>`
      tb.appendChild(tr)
    })
    // fill select in Orders
    const sel = $('#i_sel'); sel.innerHTML=''
    catalog.forEach(c=>{ const op=document.createElement('option'); op.value=c.id; op.textContent=c.name; sel.appendChild(op)})
  }
  $('#c_add').addEventListener('click', ()=>{
    const name=($('#c_name').value||'').trim(); const ppu=parseFloat($('#c_ppu').value||'0')||0
    if(!name){alert('Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù Ù…Ø·Ù„ÙˆØ¨');return}
    catalog.push({id:idCat(), name, ppu}); save(K_CAT,catalog); renderCatalog(); $('#c_name').value=''; $('#c_ppu').value=''
  })
  $('#c_clear').addEventListener('click', ()=>{ if(!confirm('ØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø£ØµÙ†Ø§ÙØŸ'))return; catalog=[]; save(K_CAT,catalog); renderCatalog()})
  $('#c_tbl').addEventListener('click', (e)=>{
    const a=e.target.closest && e.target.closest('a[data-act]'); if(!a) return; e.preventDefault()
    const id=a.getAttribute('data-id'); const ix=catalog.findIndex(c=>c.id===id); if(ix<0) return
    if(a.dataset.act==='d'){ if(confirm('Ø­Ø°Ù Ø§Ù„ØµÙ†ÙØŸ')){ catalog.splice(ix,1); save(K_CAT,catalog); renderCatalog()} }
    else{ const n=prompt('Ø§Ø³Ù… Ø§Ù„ØµÙ†Ù', catalog[ix].name); if(n===null) return; const p=parseFloat(prompt('Ø³Ø¹Ø± Ø§ÙØªØ±Ø§Ø¶ÙŠ', catalog[ix].ppu)||'0')||0; catalog[ix].name=n.trim(); catalog[ix].ppu=p; save(K_CAT,catalog); renderCatalog() }
  })

  // ===== Orders =====
  let orders = load(K_ORD)
  let editingId = null
  let items = []

  function setForm(o){
    $('#f_name').value=o.name||''; $('#f_phone').value=o.phone||''; $('#f_status').value=o.status||'New'
    $('#f_date').value=o.date||new Date().toISOString().slice(0,10); $('#f_delivery').value=o.delivery||'Office'
    $('#f_city').value=o.city||''; $('#f_notes').value=o.notes||''
    items = o.items? o.items.slice():[]; renderItems()
    $('#del').style.display = editingId? 'inline-block':'none'
  }
  function getForm(){
    const existing = editingId ? orders.find(x=>x.id===editingId) : null
    return {
      id: editingId || uid(),
      name: ($('#f_name').value||'').trim(),
      phone: ($('#f_phone').value||'').trim(),
      status: $('#f_status').value||'New',
      date: $('#f_date').value || new Date().toISOString().slice(0,10),
      delivery: $('#f_delivery').value||'Office',
      city: ($('#f_city').value||'').trim(),
      notes: ($('#f_notes').value||'').trim(),
      items: items.slice(),
      createdAt: existing && existing.createdAt ? existing.createdAt : Date.now(),
      updatedAt: Date.now()
    }
  }
  function renderItems(){
    const tb=$('#it_tbl tbody'); tb.innerHTML=''; let total=0
    items.forEach((it,i)=>{
      const sum=(it.qty||0)*(it.ppu||0); total+=sum
      const tr=document.createElement('tr')
      tr.innerHTML = `<td class="small">${i+1}</td><td>${it.variety}</td><td>${fmt(it.qty)}</td><td>${fmt(it.ppu)}</td><td>${fmt(Math.round(sum))}</td>
      <td><a href="#" data-act="e" data-i="${i}">ØªØ¹Ø¯ÙŠÙ„</a> â€¢ <a href="#" data-act="d" data-i="${i}">Ø­Ø°Ù</a></td>`
      tb.appendChild(tr)
    })
    $('#it_hint').textContent = items.length? `Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¨Ù†ÙˆØ¯: ${items.length} | Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ØªÙ‚Ø±ÙŠØ¨ÙŠ: ${fmt(Math.round(total))} Ø¯Ø¬` : 'Ø£Ø¶Ù ØµÙ†ÙÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§ Ø£Ùˆ Ø£ÙƒØ«Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø­ÙØ¸.'
  }
  $('#i_sel').addEventListener('change', ()=>{
    const cv=catalog.find(c=>c.id===$('#i_sel').value); if(cv) $('#i_ppu').value = cv.ppu || 0
  })
  $('#i_add').addEventListener('click', ()=>{
    const cv=catalog.find(c=>c.id===$('#i_sel').value); if(!cv){alert('Ø§Ø®ØªØ± ØµÙ†ÙÙ‹Ø§');return}
    const q=parseInt($('#i_qty').value||'0',10)||0; const p=parseFloat($('#i_ppu').value||'0')||0
    if(q<=0){alert('Ø¹Ø¯Ø¯ ØºÙŠØ± ØµØ§Ù„Ø­');return}
    items.push({id:idItem(), variety:cv.name, qty:q, ppu:p}); $('#i_qty').value=1; $('#i_ppu').value=cv.ppu||''; renderItems()
  })
  $('#it_tbl').addEventListener('click', (e)=>{
    const a=e.target.closest && e.target.closest('a[data-act]'); if(!a) return; e.preventDefault()
    const i=parseInt(a.getAttribute('data-i')||'-1',10); if(i<0) return
    if(a.dataset.act==='d'){ if(confirm('Ø­Ø°Ù Ø§Ù„Ø¨Ù†Ø¯ØŸ')){ items.splice(i,1); renderItems() } }
    else{ const q=parseInt(prompt('Ø§Ù„Ø¹Ø¯Ø¯', items[i].qty)||'0',10)||0; const p=parseFloat(prompt('Ø³Ø¹Ø±/ÙˆØ­Ø¯Ø©', items[i].ppu)||'0')||0; if(q<=0){alert('Ù‚ÙŠÙ…Ø© ØºÙŠØ± ØµØ§Ù„Ø­Ø©');return} items[i].qty=q; items[i].ppu=p; renderItems() }
  })

  $('#save').addEventListener('click', ()=>{
    const o=getForm(); if(!o.name){alert('Ø§Ù„Ø§Ø³Ù… Ù…Ø·Ù„ÙˆØ¨');return} if(!o.items.length){alert('Ø£Ø¶Ù ØµÙ†ÙÙ‹Ø§ ÙˆØ§Ø­Ø¯Ù‹Ø§');return}
    const ix = orders.findIndex(x=>x.id===o.id)
    if(ix>=0){ orders[ix]=o } else { orders.push(o) }
    save(K_ORD, orders); renderOrders(); setForm({items:[]}); editingId=null; updateStats(); alert(ix>=0? 'ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨' : 'ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø·Ù„Ø¨')
  })
  $('#new').addEventListener('click', ()=>{ editingId=null; setForm({items:[]}) })
  $('#del').addEventListener('click', ()=>{
    if(!editingId) return; if(!confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ØŸ'))return
    orders = orders.filter(x=>x.id!==editingId); save(K_ORD,orders); renderOrders(); editingId=null; setForm({items:[]}); updateStats()
  })

  function renderOrders(){
    const q=($('#q').value||'').trim().toLowerCase()
    const tb=$('#tbl tbody'); tb.innerHTML=''
    const filtered = orders.filter(o=> !q || (o.name&&o.name.toLowerCase().includes(q)) || (o.phone&&o.phone.toLowerCase().includes(q)) || (o.items||[]).some(it=>it.variety.toLowerCase().includes(q)) )
      .sort((a,b)=>(b.createdAt||0)-(a.createdAt||0))
    filtered.forEach((o,i)=>{
      const sum=(o.items||[]).reduce((s,it)=>s+(it.qty||0)*(it.ppu||0),0)
      const qty=(o.items||[]).reduce((s,it)=>s+(it.qty||0),0)
      const names=(o.items||[]).map(it=>it.variety).join('ØŒ ')
      const tr=document.createElement('tr')
      tr.innerHTML = `<td class="small">${i+1}</td><td>${o.name}</td><td class="small">${o.phone}</td><td>${names}</td><td>${fmt(qty)}</td><td>${fmt(Math.round(sum))}</td>
      <td><a href="#" data-id="${o.id}">ÙØªØ­</a></td>`
      tb.appendChild(tr)
    })
  }
  $('#tbl').addEventListener('click', (e)=>{
    const a=e.target.closest && e.target.closest('a[data-id]'); if(!a) return; e.preventDefault()
    const id=a.getAttribute('data-id'); const o=orders.find(x=>x.id===id); if(!o) return
    editingId=id; setForm(o); switchView('orders'); window.scrollTo(0,0)
  })
  $('#q').addEventListener('input', renderOrders)

  $('#clear').addEventListener('click', ()=>{ if(!confirm('ØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŸ'))return; orders=[]; save(K_ORD,orders); renderOrders(); updateStats() })

  // Print list grouped per customer
  $('#print').addEventListener('click', ()=>{
    const blocks = orders.map((o,i)=>{
      const items = (o.items||[]).map(it=>{
        const s=(it.qty||0)*(it.ppu||0)
        return `   â€¢ ${it.variety} Ã— ${it.qty} â€” Ø³Ø¹Ø±/ÙˆØ­Ø¯Ø©: ${it.ppu} â€” Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹: ${Math.round(s)} Ø¯Ø¬`
      }).join('\n')
      const total = (o.items||[]).reduce((s,it)=>s+(it.qty||0)*(it.ppu||0),0)
      const qty = (o.items||[]).reduce((s,it)=>s+(it.qty||0),0)
      return `${i+1}) ${o.name||''} â€“ ${o.phone||''} â€“ ${o.city||''}\n${items}\n   Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙƒÙ„ÙŠ: ${Math.round(total)} Ø¯Ø¬   |   Ø¹Ø¯Ø¯ Ø§Ù„Ø´ØªÙ„Ø§Øª: ${qty}`
    })
    const w=window.open('','_blank')
    if(!w){alert('ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù…ØªØµÙØ­ ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø©');return}
    w.document.write(`<!doctype html><html lang="ar" dir="rtl"><meta charset="utf-8"><title>Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ±</title>
    <style>body{font-family:system-ui;padding:20px} h2{margin:0 0 12px 0} pre{white-space:pre-wrap;line-height:1.7}</style>
    <h2>ğŸ§¾ Ù„Ø§Ø¦Ø­Ø© Ø§Ù„ØªØ­Ø¶ÙŠØ± (${orders.length} Ø·Ù„Ø¨)</h2><pre>${blocks.join('\n\n')}</pre><script>window.print()</script>`)
    w.document.close()
  })

  // ===== Stats =====
  function updateStats(){
    const totalOrders = orders.length
    const totalQty = orders.reduce((s,o)=>s+(o.items||[]).reduce((a,it)=>a+(it.qty||0),0),0)
    const totalSum = orders.reduce((s,o)=>s+(o.items||[]).reduce((a,it)=>a+(it.qty||0)*(it.ppu||0),0),0)
    $('#st_orders').textContent = fmt(totalOrders)
    $('#st_qty').textContent    = fmt(totalQty)
    $('#st_sum').textContent    = fmt(Math.round(totalSum))
  }

  // ===== Init =====
  // Default date
  $('#f_date').value = new Date().toISOString().slice(0,10)
  renderCatalog(); renderOrders(); updateStats(); setForm({items:[]})
})();
</script>
</body>
</html>